# Performance and confusion matrix for gold standard simulation time

ensemble_confusion_matrix.py is a python script designed to visualize the performance of different simulation times with respect to gold standard simulation time.This script is capable of running for one single gene as well as multipe genes. It generates a graph of confusion matrix of simulation time vs gold standard simulation time along with a csv file containing data about of the performance of the simulation runs. It includes sensitivity, specificity, accuracy, precision, F1 score and structure length. It can also be used to compare the performace of simulation runs for multiple gene irrespective of the structural length.

## Table of contents

- [Input] (#input)

- [Run] (#run)

- [Output] (#output)

- [Usage] (#usage)

- [Example] (#example)


## Input

The script accepts the CSV files located in the folder following the format of: input_directory_name/Gene_name/AF_XX-YY/simulation_time/energies.csv

The gold standard simulation time is a necessary folders for all the genes present in the input directory.

input_directory_name is the folder containing folders of all the necessary genes

Gene_name should be a separate folder with the naming convention of all the necessary genes repectively. 

AF_XX-YY is a folder with structural information for the gene

simulation_time are folders containing different simulation runs with different simulation time which is used by script to generate performance and confusion matrix. The folder should only contain a CSV file with the information on energies generated by rosetta

├── ensemble_confusion_matrix.py
├── readme.txt
├── runs
│   ├── ACVR1B
│   │   └── AF2_29-110
│   │       ├── 100
│   │       │   └── energies.csv
│   │       ├── 1000
│   │       │   └── energies.csv
│   │       └── 500
│   │           └── energies.csv
│   ├── APOC1
│   │   └── AF2_183
│   │       ├── 100
│   │       │   └── energies.csv
│   │       ├── 1000
│   │       │   └── energies.csv
│   │       └── 500
│   │           └── energies.csv
│   ├── ATG12
│   │   └── AF2_44-140
│   │       ├── 100
│   │       │   └── energies.csv
│   │       ├── 1000
│   │       │   └── energies.csv
│   │       └── 500
│   │           └── energies.csv
│   ├── BCL2L1
│   │   └── 2LPC_1-169
│   │       ├── 100
│   │       │   └── energies.csv
│   │       ├── 1000
│   │       │   └── energies.csv
│   │       └── 500
│   │           └── energies.csv
│   └── templates
│       └── GENE_NAME
│           └── AF2_XX-YY
│               ├── 100
│               ├── 1000
│               └── 500
└── run.sh




## Run

The script requires three arguments from the user in the following order :

1. input_directory: Its the name of the directory where all the folders of genes are stored

2. simulation_time: Its the gold standard simulation time which should be present in all the gene folders

3. output_directory: Its the name of the output directory to store the results generated via script


The script takes these input and goes collects information about the path of all the sub-directories. The script also stores the energies.csv file to classify according to MAVISP classification. The MAVISP classification is as follows:

- stabilizing: < -3
- destabilizing: > 3
- Neutral: -2<= and <= 2
- Uncertain

After classification of the data the script consolidates the data by dividing the data into two sections: 
1. A dictionary of data containing values and information such as path, gene name, structure length and simulation time for gold standard simulation time as input by the user. 
2. A dictionary of data containing values and information for every other simulation time which needs to be compared with the gold standard

This consolidated data is used to generate the confusion matrix: 
- TP (True positive): Refers to the count of neutral effects according to mavisp classification for stability module.

- TN (True negative): Refers to the count of destabilizing effects according to mavisp classification for stability module.

- FP (False positive): Denotes the count of destabilizing effects classified as neutral.

- FN (False negative): Denotes the count of neutral effects classified as destabilizing.

The script supports the following performance metrics:

- Sensitivity: Calculated as TP / (TP + FN).

- Specificity: Calculated as TN / (TN + FP).

- Accuracy: Calculated as (TP + TN) / (TP + TN + FP + FN).

- Precision: Calculated as TP / (TP + FP).

- F1 Score: Calculated as 2 * TP / (2 * TP + FP + FN).

- MCC Score:Calculated as (TP * TN - FP * FN) / (sqrt (TP + FP) * (TP + FN) * (TN + FP) * (TN * FN)).

These metrics provide valuable insights into the performance of simulation time with respect to the gold standard simulation time.

Upon completion the output files that generated are:
- pdf and png file of confusion matrix
- csv file of performace metrics 

The performace metrics csv file contains six columns with information of sensitivity, specificity, accuracy, precison, F1 score and the structure or gene length: 

| sensitivity | specificity | accuracy | precision | F1 score | gene length |
|:------------:|:-------------:|:---------:|:------------:|:---------:|:------------:|
|    0.986         |        1             |     0.997      |         1           |     0.993      |   AF2_29-110   |

## Output

The structure of output files is as follows:
├── output
│   ├── 1000ns_100ns_stability_comparison_ACVR1B.pdf
│   ├── 1000ns_100ns_stability_comparison_ACVR1B.png
│   ├── 1000ns_100ns_stability_comparison_APOC1.pdf
│   ├── 1000ns_100ns_stability_comparison_APOC1.png
│   ├── 1000ns_100ns_stability_comparison_ATG12.pdf
│   ├── 1000ns_100ns_stability_comparison_ATG12.png
│   ├── 1000ns_100ns_stability_comparison_BCL2L1.pdf
│   ├── 1000ns_100ns_stability_comparison_BCL2L1.png
│   ├── 1000ns_500ns_stability_comparison_ACVR1B.pdf
│   ├── 1000ns_500ns_stability_comparison_ACVR1B.png
│   ├── 1000ns_500ns_stability_comparison_APOC1.pdf
│   ├── 1000ns_500ns_stability_comparison_APOC1.png
│   ├── 1000ns_500ns_stability_comparison_ATG12.pdf
│   ├── 1000ns_500ns_stability_comparison_ATG12.png
│   ├── 1000ns_500ns_stability_comparison_BCL2L1.pdf
│   ├── 1000ns_500ns_stability_comparison_BCL2L1.png
│   ├── 1000ns_combined_100ns_stability_comparison_all_genes.pdf
│   ├── 1000ns_combined_100ns_stability_comparison_all_genes.png
│   ├── 1000ns_combined_500ns_stability_comparison_all_genes.pdf
│   ├── 1000ns_combined_500ns_stability_comparison_all_genes.png
│   ├── performance_metrics_ACVR1B_100_vs_1000.csv
│   ├── performance_metrics_ACVR1B_500_vs_1000.csv
│   ├── performance_metrics_all_genes_combined_100_vs_1000.csv
│   ├── performance_metrics_all_genes_combined_500_vs_1000.csv
│   ├── performance_metrics_APOC1_100_vs_1000.csv
│   ├── performance_metrics_APOC1_500_vs_1000.csv
│   ├── performance_metrics_ATG12_100_vs_1000.csv
│   ├── performance_metrics_ATG12_500_vs_1000.csv
│   ├── performance_metrics_BCL2L1_100_vs_1000.csv
│   └── performance_metrics_BCL2L1_500_vs_1000.csv

## Usage 
Run the bash script or python script 

bash script:
```sh
bash run.sh input_directory simulation_time output_directory

python script:
```python
python ensemble_confusion_matrix.py input_directory simulation_time output_directory


## Example

Please see the example folder
